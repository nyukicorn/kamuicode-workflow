# 生成音楽ファイル - 音楽分析専門家による詳細分析フレームワーク

## 分析対象情報
- **ファイル**: `music-video-20250718-16370232967/music/generated-music.wav`
- **コンセプト**: 淡くピンク色の美しいポピーをイメージした可愛らしいオルゴールの曲。ただ少し切ない音色も入れて。
- **分析日**: 2025年7月18日

## 戦略計画基準との比較チェック項目

### 📊 1. 楽曲の長さ（秒数）分析

**戦略計画期待値**: 30-40秒
**測定方法**: 
```python
# 実行コマンド例
cd music-video-20250718-16370232967/analysis
python basic_file_analysis.py
```

**評価基準**:
- ✅ **OK**: 30-40秒範囲内
- ⚠️ **要調整**: 28-42秒（許容範囲）
- ❌ **要大幅調整**: 範囲外

**想定される結果パターン**:
- **短すぎる場合** (< 30秒): 動画速度を遅くするか、楽曲延長
- **長すぎる場合** (> 40秒): 動画速度を上げるか、楽曲短縮
- **適切な場合** (30-40秒): 現在の戦略計画を維持

### 🎵 2. テンポ（BPM）詳細測定

**戦略計画期待値**: 75BPM (70-80BPM許容範囲)
**測定方法**:
```python
# librosaを使用したテンポ検出
tempo, beats = librosa.beat.beat_track(y=audio, sr=sample_rate)
```

**詳細分析項目**:
- **メインBPM**: 主要なテンポ値
- **平均BPM**: 全体の平均テンポ
- **テンポ変動**: 標準偏差による安定性
- **ビート検出精度**: 検出できたビート数

**戦略計画への影響評価**:
- **70-80BPM**: 動画切り替え間隔(4ビート/3-3.5秒)に最適
- **60-70BPM**: 動画を1.1-1.2倍速で調整
- **80-90BPM**: 動画を0.8-0.9倍速で調整

### 🎼 3. 音楽構造分析

**戦略計画期待構造**:
```
0-8秒   : イントロ (優しい導入)
8-16秒  : 第1テーマ (メインメロディ展開)
16-24秒 : 第2テーマ (情感の高まり)
24-32秒 : クライマックス (感情のピーク)
32-40秒 : アウトロ (余韻と終息)
```

**実際の構造検出方法**:
1. **RMSエネルギー分析**: 音量レベルの変化
2. **スペクトル重心分析**: 音色の明るさ変化
3. **オンセット検出**: 新しい音の始まり
4. **ハーモニー分析**: 和音の変化

**構造比較評価**:
- **変化点タイミング**: 8秒間隔での構造変化確認
- **エネルギー推移**: 各セクションの音量特性
- **音色変化**: セクション間の音色差異

### 🎹 4. 楽器構成分析

**期待される楽器**:
- **メイン**: オルゴール（金属的な澄んだ音色）
- **サブ**: 切ない要素を追加する楽器

**分析手法**:
```python
# スペクトル特徴量分析
spectral_centroids = librosa.feature.spectral_centroid(y=audio, sr=sr)
spectral_bandwidth = librosa.feature.spectral_bandwidth(y=audio, sr=sr)
mfccs = librosa.feature.mfcc(y=audio, sr=sr, n_mfcc=13)
```

**楽器同定基準**:
- **オルゴール**: 高い周波数帯域、短い持続時間、金属的倍音
- **ストリングス**: 広い周波数帯域、長い持続時間
- **ピアノ**: 中程度の周波数、明確なアタック
- **パッド/アンビエント**: 低い周波数、長い持続時間

### 💫 5. 雰囲気・感情変化分析

**コンセプト要素**:
- **可愛らしさ**: 明るい高音域、軽やかなリズム
- **切ない要素**: 短調和音、低めのスペクトル重心

**感情分析指標**:
```python
# 感情指標の計算例
sadness_indicator = (
    low_spectral_centroid_score +
    minor_chord_detection_score +
    low_energy_score
)
```

**出現タイミング分析**:
- **切ない要素の出現箇所**: 特定の時間帯での検出
- **感情の転換点**: 可愛らしさから切なさへの変化
- **感情の強度**: 各感情要素の強さ

### 📈 6. 音量レベル変化

**分析項目**:
- **動的レンジ**: 最大音量と最小音量の差
- **RMS推移**: 実効値による音量変化
- **ピーク分布**: 音量のピーク出現パターン

**戦略計画への影響**:
- **音量変化**: 動画の視覚的密度調整
- **クライマックス位置**: 最大音量箇所の特定
- **フェード特性**: 開始・終了部分の音量変化

### 🎶 7. 拍子・リズムパターン

**分析要素**:
- **基本拍子**: 4/4拍子 vs 3/4拍子 vs 変則拍子
- **リズムの複雑さ**: パターンの規則性
- **ビート安定性**: テンポの一貫性

**オルゴール特有の特徴**:
- **機械的正確性**: 一定のテンポ維持
- **音符の明確性**: 各音の分離が明確
- **装飾音**: トリルやグリッサンドの有無

## 戦略計画整合性チェック

### ✅ 理想的なケース
- **楽曲長**: 30-40秒 ✓
- **テンポ**: 70-80BPM ✓
- **構造**: 明確な5セクション ✓
- **感情**: 可愛さ + 切なさのバランス ✓

**→ 現在の戦略計画をそのまま適用可能**

### ⚠️ 調整が必要なケース

#### 楽曲長の調整
**短い場合** (< 30秒):
- 動画速度: 0.8-0.9倍速に調整
- 構造分割: より細かいセクション分割
- エフェクト: 長めのトランジション

**長い場合** (> 40秒):
- 動画速度: 1.1-1.2倍速に調整
- 構造分割: より大きなセクション分割
- エフェクト: 短めのトランジション

#### テンポの調整
**遅い場合** (< 70BPM):
- 動画切り替え: 4秒間隔に調整
- 動き: より動的な要素を追加
- エフェクト: 速度感を演出

**速い場合** (> 80BPM):
- 動画切り替え: 3秒間隔に調整
- 動き: より静的な要素を重視
- エフェクト: 滑らかなトランジション

## 画像・動画プロンプト微調整提案

### 🌸 セクション別微調整案

#### イントロ部分 (0-8秒相当)
**現在**: 静的な美しさ、穏やかな風景
**分析結果による調整**:
- **音量が小さい場合**: より静寂で神秘的な雰囲気
- **オルゴール音が強い場合**: 金属的な光の演出追加
- **切ない要素が早い場合**: 少し憂いを帯びた色調

#### 第1テーマ (8-16秒相当)
**現在**: メインメロディ展開
**分析結果による調整**:
- **楽器が複数の場合**: より豊かな動きの表現
- **メロディが明確な場合**: 主題となるポピーの強調
- **リズムが複雑な場合**: 動きの変化を増加

#### 第2テーマ (16-24秒相当)
**現在**: 情感の高まり
**分析結果による調整**:
- **感情変化が強い場合**: より dramatic な視覚効果
- **和音が豊かな場合**: 複数のポピーの調和
- **切ない要素が出現**: 色調の変化を強調

#### クライマックス (24-32秒相当)
**現在**: 感情のピーク
**分析結果による調整**:
- **音量ピークが明確**: 最も印象的な視覚効果
- **楽器が重層的**: 複雑な動きの組み合わせ
- **感情が最高潮**: 色彩の最も美しい瞬間

#### アウトロ (32-40秒相当)
**現在**: 余韻と終息
**分析結果による調整**:
- **フェードが長い**: ゆっくりとした終息
- **音色が変化**: 残響効果の視覚化
- **静寂への移行**: 徐々に静的になる動き

### 🎨 プロンプト微調整具体例

#### 色調調整
```
# 切ない要素が強い場合
"少し曇った空の下で、淡いピンクのポピーが優しく揺れる"

# 可愛らしさが強い場合
"明るい陽光の下で、鮮やかなピンクのポピーが楽しげに踊る"
```

#### 動きの調整
```
# テンポが遅い場合
"ゆっくりと、夢のような動きで"

# テンポが速い場合
"軽やかに、リズミカルに"
```

#### エフェクト調整
```
# 音量変化が大きい場合
"光の強弱が音楽に合わせて変化する"

# 楽器が複数の場合
"複数の花びらが異なるリズムで舞い踊る"
```

## 実装優先順位

### 📋 Phase 1: 基本分析
1. **ファイル基本情報取得**
   - 楽曲長、サンプルレート、チャンネル数
   - 戦略計画との基本的な整合性確認

2. **テンポ測定**
   - BPM値の特定
   - 動画速度調整の必要性判定

### 📋 Phase 2: 詳細分析
1. **構造分析**
   - セクション分割の確認
   - 各セクションの特徴量測定

2. **楽器・音色分析**
   - 主要楽器の特定
   - 音色特徴の定量化

### 📋 Phase 3: 感情・表現分析
1. **感情変化分析**
   - 切ない要素の出現タイミング
   - 感情の強度変化

2. **プロンプト微調整提案**
   - 具体的な調整内容の提示
   - 実装の優先順位付け

## 分析実行ガイド

### 必要なツール
```bash
# Python環境の準備
pip install librosa soundfile matplotlib numpy

# 分析実行
cd music-video-20250718-16370232967/analysis
python comprehensive_music_analysis.py
```

### 結果の解釈
1. **数値結果の評価**: 戦略計画との数値比較
2. **視覚的確認**: スペクトログラム、波形表示
3. **聴覚的確認**: 実際の音楽再生による確認
4. **総合判断**: 調整の必要性とその程度

この分析フレームワークにより、生成音楽の特徴を正確に把握し、最適な画像・動画プロンプトの微調整を実現します。