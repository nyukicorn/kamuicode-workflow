name: 'Video World Analysis'
description: 'Analyze video content to extract comprehensive world characteristics for immersive experience'
author: 'KamuiCode Workflow'

inputs:
  # ÂãïÁîªÂÖ•Âäõ„Ç™„Éó„Ç∑„Éß„É≥ÔºàË§áÊï∞ÂΩ¢ÂºèÂØæÂøúÔºâ
  video-prompt:
    description: 'Video content description'
    required: false
  video-url:
    description: 'URL to video file'
    required: false
  video-file:
    description: 'Path to local video file'
    required: false
  video-description:
    description: 'Detailed description of video content'
    required: false
  
  # ÂÖ±ÈÄöË®≠ÂÆö
  folder-name:
    description: 'The folder name for storing analysis files'
    required: true
  branch-name:
    description: 'The branch to work on'
    required: true
  oauth-token:
    description: 'Claude Code OAuth token'
    required: true
  skip-commit:
    description: 'Skip commit and push step (for multimodal workflows)'
    required: false
    default: 'false'

outputs:
  # Ë¶ñË¶öÁöÑÁâπÊÄß
  scene-type:
    description: 'Primary scene type (nature/urban/interior/fantasy/dramatic/etc.)'
    value: ${{ steps.analysis.outputs.scene-type }}
  atmosphere:
    description: 'Overall atmosphere (peaceful/energetic/mysterious/dramatic/etc.)'
    value: ${{ steps.analysis.outputs.atmosphere }}
  visual-style:
    description: 'Visual style (realistic/stylized/cinematic/documentary/etc.)'
    value: ${{ steps.analysis.outputs.visual-style }}
  color-palette:
    description: 'Dominant color palette (warm/cool/monochrome/vibrant/etc.)'
    value: ${{ steps.analysis.outputs.color-palette }}
  lighting-quality:
    description: 'Lighting quality (natural/artificial/dramatic/soft/etc.)'
    value: ${{ steps.analysis.outputs.lighting-quality }}
  
  # ÂãïÁöÑÁâπÊÄß
  movement-type:
    description: 'Type of movement (static/slow/dynamic/chaotic/rhythmic/etc.)'
    value: ${{ steps.analysis.outputs.movement-type }}
  camera-movement:
    description: 'Camera movement style (steady/handheld/smooth/tracking/etc.)'
    value: ${{ steps.analysis.outputs.camera-movement }}
  pace:
    description: 'Overall pace (slow/medium/fast/varied)'
    value: ${{ steps.analysis.outputs.pace }}
  energy-level:
    description: 'Energy level (1-10)'
    value: ${{ steps.analysis.outputs.energy-level }}
  
  # Èü≥ÈüøÁâπÊÄß
  audio-type:
    description: 'Audio type (music/dialogue/ambient/sound-effects/mixed/etc.)'
    value: ${{ steps.analysis.outputs.audio-type }}
  audio-atmosphere:
    description: 'Audio atmosphere (calm/intense/mysterious/uplifting/etc.)'
    value: ${{ steps.analysis.outputs.audio-atmosphere }}
  audio-quality:
    description: 'Audio quality (studio/live/ambient/processed/etc.)'
    value: ${{ steps.analysis.outputs.audio-quality }}
  
  # Á©∫Èñì„ÉªÊôÇÈñìÁâπÊÄß
  spatial-scale:
    description: 'Spatial scale (intimate/room/building/landscape/cosmic/etc.)'
    value: ${{ steps.analysis.outputs.spatial-scale }}
  depth-perception:
    description: 'Depth perception (flat/moderate/deep/immersive)'
    value: ${{ steps.analysis.outputs.depth-perception }}
  time-period:
    description: 'Time period (historical/contemporary/futuristic/timeless)'
    value: ${{ steps.analysis.outputs.time-period }}
  duration-feel:
    description: 'Duration feeling (brief/extended/epic/cyclical/etc.)'
    value: ${{ steps.analysis.outputs.duration-feel }}
  
  # ÂÜÖÂÆπ„Éª„ÉÜ„Éº„ÉûÁâπÊÄß
  content-genre:
    description: 'Content genre (documentary/narrative/abstract/educational/etc.)'
    value: ${{ steps.analysis.outputs.content-genre }}
  emotional-arc:
    description: 'Emotional arc (stable/building/climactic/varied/etc.)'
    value: ${{ steps.analysis.outputs.emotional-arc }}
  cultural-context:
    description: 'Cultural context (western/eastern/universal/specific/etc.)'
    value: ${{ steps.analysis.outputs.cultural-context }}
  
  # ÊäÄË°ì„ÉªÂìÅË≥™ÁâπÊÄß
  production-quality:
    description: 'Production quality (professional/amateur/artistic/experimental/etc.)'
    value: ${{ steps.analysis.outputs.production-quality }}
  technical-style:
    description: 'Technical style (polished/raw/stylized/naturalistic/etc.)'
    value: ${{ steps.analysis.outputs.technical-style }}
  
  # „É°„Çø„Éá„Éº„Çø
  analysis-completed:
    description: 'Whether analysis was completed successfully'
    value: ${{ steps.analysis.outputs.completed }}
  confidence:
    description: 'Analysis confidence score (0.0-1.0)'
    value: ${{ steps.analysis.outputs.confidence }}

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.branch-name }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Claude Code SDK
      shell: bash
      run: npm install @anthropic-ai/claude-code
    
    - name: ÂãïÁîª‰∏ñÁïåË¶≥ÂàÜÊûê„Ç®„Éº„Ç∏„Çß„É≥„Éà
      id: analysis
      shell: bash
      env:
        CLAUDE_CODE_OAUTH_TOKEN: ${{ inputs.oauth-token }}
      run: |
        echo "::group::üé¨ Video World Analysis Agent Execution"
        echo "Starting at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
        
        # Ë®≠ÂÆö
        FOLDER_NAME="${{ inputs.folder-name }}"
        ANALYSIS_DIR="$FOLDER_NAME/world-analysis"
        
        echo "Analysis folder: $ANALYSIS_DIR"
        
        # ÂàÜÊûê„Éï„Ç©„É´„ÉÄ„Çí‰∫ãÂâç„Å´‰ΩúÊàê
        if [ ! -d "$ANALYSIS_DIR" ]; then
          mkdir -p "$ANALYSIS_DIR"
          echo "üìÅ Created analysis folder: $ANALYSIS_DIR"
        fi
        
        # ÂÖ•Âäõ„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç„Å®Êï¥ÁêÜ
        VIDEO_PROMPT="${{ inputs.video-prompt }}"
        VIDEO_URL="${{ inputs.video-url }}"
        VIDEO_FILE="${{ inputs.video-file }}"
        VIDEO_DESCRIPTION="${{ inputs.video-description }}"
        
        echo "Input validation:"
        echo "- Video prompt: ${VIDEO_PROMPT:+provided}"
        echo "- Video URL: ${VIDEO_URL:+provided}"
        echo "- Video file: ${VIDEO_FILE:+provided}"
        echo "- Video description: ${VIDEO_DESCRIPTION:+provided}"
        
        # ÂÖ•ÂäõÊ§úË®º
        INPUT_COUNT=0
        INPUT_TYPE=""
        
        if [ -n "$VIDEO_PROMPT" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="prompt"
          echo "‚úÖ Using video prompt input"
        fi
        
        if [ -n "$VIDEO_URL" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="url"
          echo "‚úÖ Using video URL input"
        fi
        
        if [ -n "$VIDEO_FILE" ] && [ -f "$VIDEO_FILE" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="file"
          echo "‚úÖ Using video file input: $VIDEO_FILE"
        fi
        
        if [ -n "$VIDEO_DESCRIPTION" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="description"
          echo "‚úÖ Using video description input"
        fi
        
        if [ "$INPUT_COUNT" -eq 0 ]; then
          echo "::error::‚ùå No video input provided"
          exit 1
        fi
        
        if [ "$INPUT_COUNT" -gt 1 ]; then
          echo "::warning::‚ö†Ô∏è Multiple video inputs provided, using first available"
        fi
        
        # „Éó„É≠„É≥„Éó„Éà„ÅÆÊßãÁØâ
        PROMPT="„ÅÇ„Å™„Åü„ÅØÂãïÁîª„Ç≥„É≥„ÉÜ„É≥„ÉÑÂàÜÊûê„Åã„ÇâÁ∑èÂêàÁöÑ„Å™‰∏ñÁïåË¶≥ÁâπÊÄß„ÇíÊäΩÂá∫„Åô„ÇãÂ∞ÇÈñÄÂÆ∂„Åß„Åô„ÄÇ"
        
        if [ -n "$VIDEO_PROMPT" ]; then
          PROMPT="$PROMPT
        
        **ÂãïÁîª„Ç≥„É≥„ÉÜ„É≥„ÉÑË™¨Êòé**:
        $VIDEO_PROMPT"
        elif [ -n "$VIDEO_DESCRIPTION" ]; then
          PROMPT="$PROMPT
        
        **ÂãïÁîªË©≥Á¥∞Ë™¨Êòé**:
        $VIDEO_DESCRIPTION"
        elif [ -n "$VIDEO_URL" ]; then
          PROMPT="$PROMPT
        
        **ÂãïÁîªURL**: $VIDEO_URL
        (URL„Åã„ÇâÂãïÁîªÂÜÖÂÆπ„ÇíÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ)"
        elif [ -n "$VIDEO_FILE" ]; then
          PROMPT="$PROMPT
        
        **ÂãïÁîª„Éï„Ç°„Ç§„É´**: $VIDEO_FILE
        („Éï„Ç°„Ç§„É´„Åã„ÇâÂãïÁîªÂÜÖÂÆπ„ÇíÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ)"
        fi
        
        PROMPT="$PROMPT
        
        **ÂàÜÊûê„Çø„Çπ„ÇØ**:
        ÂãïÁîª„ÅÆË¶ñË¶ö„ÉªËÅ¥Ë¶ö„ÉªÊôÇÈñìÁöÑÁâπÊÄß„ÇíÂåÖÊã¨ÁöÑ„Å´ÂàÜÊûê„Åó„ÄÅ3D‰ΩìÈ®ì„ÇÑ‰∏ñÁïåË¶≥ÊßãÁØâ„Å´Ê¥ªÁî®„Åß„Åç„ÇãÁâπÊÄß„ÇíÊäΩÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
        
        **ÂàÜÊûêË¶ÅÁ¥†**:
        1. **Ë¶ñË¶öÁöÑÁâπÊÄß**:
           - scene_type: ‰∏ªË¶Å„Ç∑„Éº„É≥„Çø„Ç§„ÉóÔºànature/urban/interior/fantasy/dramatic/etc.Ôºâ
           - atmosphere: ÂÖ®‰ΩìÁöÑÈõ∞Âõ≤Ê∞óÔºàpeaceful/energetic/mysterious/dramatic/etc.Ôºâ
           - visual_style: Ë¶ñË¶ö„Çπ„Çø„Ç§„É´Ôºàrealistic/stylized/cinematic/documentary/etc.Ôºâ
           - color_palette: ÊîØÈÖçÁöÑ„Ç´„É©„Éº„Éë„É¨„ÉÉ„ÉàÔºàwarm/cool/monochrome/vibrant/etc.Ôºâ
           - lighting_quality: ÁÖßÊòéÂìÅË≥™Ôºànatural/artificial/dramatic/soft/etc.Ôºâ
        
        2. **ÂãïÁöÑÁâπÊÄß**:
           - movement_type: Âãï„Åç„ÅÆ„Çø„Ç§„ÉóÔºàstatic/slow/dynamic/chaotic/rhythmic/etc.Ôºâ
           - camera_movement: „Ç´„É°„É©Âãï‰Ωú„Çπ„Çø„Ç§„É´Ôºàsteady/handheld/smooth/tracking/etc.Ôºâ
           - pace: ÂÖ®‰ΩìÁöÑ„Éö„Éº„ÇπÔºàslow/medium/fast/variedÔºâ
           - energy_level: „Ç®„Éç„É´„ÇÆ„Éº„É¨„Éô„É´Ôºà1-10Ôºâ
        
        3. **Èü≥ÈüøÁâπÊÄß**:
           - audio_type: Èü≥Â£∞„Çø„Ç§„ÉóÔºàmusic/dialogue/ambient/sound-effects/mixed/etc.Ôºâ
           - audio_atmosphere: Èü≥Â£∞Èõ∞Âõ≤Ê∞óÔºàcalm/intense/mysterious/uplifting/etc.Ôºâ
           - audio_quality: Èü≥Â£∞ÂìÅË≥™Ôºàstudio/live/ambient/processed/etc.Ôºâ
        
        4. **Á©∫Èñì„ÉªÊôÇÈñìÁâπÊÄß**:
           - spatial_scale: Á©∫Èñì„Çπ„Ç±„Éº„É´Ôºàintimate/room/building/landscape/cosmic/etc.Ôºâ
           - depth_perception: Â••Ë°å„ÅçÁü•Ë¶öÔºàflat/moderate/deep/immersiveÔºâ
           - time_period: ÊôÇ‰ª£Ôºàhistorical/contemporary/futuristic/timelessÔºâ
           - duration_feel: ÊåÅÁ∂öÊÑüÔºàbrief/extended/epic/cyclical/etc.Ôºâ
        
        5. **ÂÜÖÂÆπ„Éª„ÉÜ„Éº„ÉûÁâπÊÄß**:
           - content_genre: „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç∏„É£„É≥„É´Ôºàdocumentary/narrative/abstract/educational/etc.Ôºâ
           - emotional_arc: ÊÑüÊÉÖ„Ç¢„Éº„ÇØÔºàstable/building/climactic/varied/etc.Ôºâ
           - cultural_context: ÊñáÂåñÁöÑÊñáËÑàÔºàwestern/eastern/universal/specific/etc.Ôºâ
        
        6. **ÊäÄË°ì„ÉªÂìÅË≥™ÁâπÊÄß**:
           - production_quality: Âà∂‰ΩúÂìÅË≥™Ôºàprofessional/amateur/artistic/experimental/etc.Ôºâ
           - technical_style: ÊäÄË°ì„Çπ„Çø„Ç§„É´Ôºàpolished/raw/stylized/naturalistic/etc.Ôºâ
        
        **ÊôÇÈñìÁöÑÂ§âÂåñ„ÅÆÂàÜÊûê**:
        ÂãïÁîª„ÅÆÂ†¥Âêà„ÄÅÊôÇÈñìÁµåÈÅé„Å´‰º¥„ÅÜÂ§âÂåñ„ÇÇÈáçË¶Å„Åß„Åô„ÄÇ‰∏ªË¶Å„Å™Ëª¢ÊèõÁÇπ„ÇÑÊÑüÊÉÖ„ÅÆÂ§âÂåñ„Åå„ÅÇ„Çå„Å∞„ÄÅ
        **$ANALYSIS_DIR/temporal-analysis.srt** „Éï„Ç°„Ç§„É´„ÇÇ‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
        
        **ÂøÖÈ†àÂá∫Âäõ„Éï„Ç°„Ç§„É´**:
        1. **$ANALYSIS_DIR/video-analysis.json** - ÊßãÈÄ†Âåñ„Åï„Çå„ÅüÂàÜÊûêÁµêÊûú
        2. **$ANALYSIS_DIR/video-analysis.md** - Ë©≥Á¥∞ÂàÜÊûê„É¨„Éù„Éº„Éà
        3. **$ANALYSIS_DIR/video-summary.txt** - 1Ë°åË¶ÅÁ¥Ñ
        4. **$ANALYSIS_DIR/temporal-analysis.srt** („Ç™„Éó„Ç∑„Éß„É≥) - ÊôÇÈñìÁöÑÂ§âÂåñÂàÜÊûê
        
        **JSON„Éï„Ç©„Éº„Éû„ÉÉ„Éà**:
        \`\`\`json
        {
          \"scene_type\": \"nature\",
          \"atmosphere\": \"peaceful\",
          \"visual_style\": \"cinematic\",
          \"color_palette\": \"warm\",
          \"lighting_quality\": \"natural\",
          \"movement_type\": \"slow\",
          \"camera_movement\": \"smooth\",
          \"pace\": \"slow\",
          \"energy_level\": 4,
          \"audio_type\": \"ambient\",
          \"audio_atmosphere\": \"calm\",
          \"audio_quality\": \"studio\",
          \"spatial_scale\": \"landscape\",
          \"depth_perception\": \"deep\",
          \"time_period\": \"contemporary\",
          \"duration_feel\": \"extended\",
          \"content_genre\": \"documentary\",
          \"emotional_arc\": \"stable\",
          \"cultural_context\": \"universal\",
          \"production_quality\": \"professional\",
          \"technical_style\": \"polished\",
          \"confidence\": 0.9,
          \"input_type\": \"$INPUT_TYPE\",
          \"analysis_timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"
        }
        \`\`\`
        
        **ÈáçË¶Å„Å™Ê≥®ÊÑèÁÇπ**:
        1. ÂÖ®„Å¶„ÅÆÂÄ§„ÅØÊåáÂÆö„Åï„Çå„ÅüÈÅ∏ÊäûËÇ¢„Åæ„Åü„ÅØÊï∞ÂÄ§ÁØÑÂõ≤ÂÜÖ„ÅßË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        2. Ë¶ñË¶ö„Å®ËÅ¥Ë¶ö„ÅÆ‰∏°Êñπ„ÅÆË¶ÅÁ¥†„ÇíÁ∑èÂêàÁöÑ„Å´ËÄÉÊÖÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        3. ÂãïÁîª„ÅÆÊôÇÈñìÁöÑÂ±ïÈñã„ÇÇÂàÜÊûê„Å´Âê´„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ
        4. 3D‰ΩìÈ®ì„ÇÑ‰∏ñÁïåË¶≥ÊßãÁØâ„Å∏„ÅÆÈÅ©Áî®ÂèØËÉΩÊÄß„ÇíËÄÉÊÖÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        5. „Éï„Ç°„Ç§„É´‰ΩúÊàêÂæå„ÄÅ„Éï„Ç°„Ç§„É´„Éë„Çπ„ÇíÁ¢∫Ë™ç„ÉªÂ†±Âëä„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
        
        echo "üöÄ Starting Video World Analysis Agent Claude Code CLI..."
        echo "üìù Prompt length: ${#PROMPT}"
        
        # Claude Code CLI„ÅÆÂÆüË°å
        npx @anthropic-ai/claude-code \
          --allowedTools "Read,Write,Edit,Bash" \
          --max-turns 20 \
          --verbose \
          --permission-mode "bypassPermissions" \
          -p "$PROMPT" || {
            echo "::error::‚ùå Claude Code CLI execution failed"
            exit 1
          }
        
        # ÁîüÊàê„Åï„Çå„ÅüÂàÜÊûêÁµêÊûú„ÅÆÁ¢∫Ë™ç„Å®Âá∫ÂäõË®≠ÂÆö
        echo ""
        echo "üìã Checking generated analysis files..."
        
        # JSONÂàÜÊûêÁµêÊûú„ÅÆÁ¢∫Ë™ç„Å®Âá∫ÂäõË®≠ÂÆö
        if [ -f "$ANALYSIS_DIR/video-analysis.json" ]; then
          echo "::notice::‚úÖ Video analysis JSON generated"
          
          # JSON„Åã„ÇâÂÄ§„ÇíÊäΩÂá∫„Åó„Å¶GitHub Output„Å´Ë®≠ÂÆö
          SCENE_TYPE=$(grep -o '"scene_type"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          ATMOSPHERE=$(grep -o '"atmosphere"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          VISUAL_STYLE=$(grep -o '"visual_style"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          COLOR_PALETTE=$(grep -o '"color_palette"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          LIGHTING_QUALITY=$(grep -o '"lighting_quality"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          MOVEMENT_TYPE=$(grep -o '"movement_type"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CAMERA_MOVEMENT=$(grep -o '"camera_movement"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          PACE=$(grep -o '"pace"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          ENERGY_LEVEL=$(grep -o '"energy_level"[[:space:]]*:[[:space:]]*[0-9]*' "$ANALYSIS_DIR/video-analysis.json" | cut -d':' -f2 | tr -d ' ')
          AUDIO_TYPE=$(grep -o '"audio_type"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          AUDIO_ATMOSPHERE=$(grep -o '"audio_atmosphere"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          AUDIO_QUALITY=$(grep -o '"audio_quality"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          SPATIAL_SCALE=$(grep -o '"spatial_scale"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          DEPTH_PERCEPTION=$(grep -o '"depth_perception"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          TIME_PERIOD=$(grep -o '"time_period"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          DURATION_FEEL=$(grep -o '"duration_feel"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CONTENT_GENRE=$(grep -o '"content_genre"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          EMOTIONAL_ARC=$(grep -o '"emotional_arc"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CULTURAL_CONTEXT=$(grep -o '"cultural_context"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          PRODUCTION_QUALITY=$(grep -o '"production_quality"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          TECHNICAL_STYLE=$(grep -o '"technical_style"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CONFIDENCE=$(grep -o '"confidence"[[:space:]]*:[[:space:]]*[0-9.]*' "$ANALYSIS_DIR/video-analysis.json" | cut -d':' -f2 | tr -d ' ')
          
          echo "Scene type: $SCENE_TYPE"
          echo "Atmosphere: $ATMOSPHERE"
          echo "Visual style: $VISUAL_STYLE"
          echo "Color palette: $COLOR_PALETTE"
          echo "Lighting quality: $LIGHTING_QUALITY"
          echo "Movement type: $MOVEMENT_TYPE"
          echo "Camera movement: $CAMERA_MOVEMENT"
          echo "Pace: $PACE"
          echo "Energy level: $ENERGY_LEVEL"
          echo "Audio type: $AUDIO_TYPE"
          echo "Audio atmosphere: $AUDIO_ATMOSPHERE"
          echo "Audio quality: $AUDIO_QUALITY"
          echo "Spatial scale: $SPATIAL_SCALE"
          echo "Depth perception: $DEPTH_PERCEPTION"
          echo "Time period: $TIME_PERIOD"
          echo "Duration feel: $DURATION_FEEL"
          echo "Content genre: $CONTENT_GENRE"
          echo "Emotional arc: $EMOTIONAL_ARC"
          echo "Cultural context: $CULTURAL_CONTEXT"
          echo "Production quality: $PRODUCTION_QUALITY"
          echo "Technical style: $TECHNICAL_STYLE"
          echo "Analysis confidence: $CONFIDENCE"
          
          # GitHub Output„Å´Ë®≠ÂÆö
          echo "scene-type=${SCENE_TYPE:-nature}" >> $GITHUB_OUTPUT
          echo "atmosphere=${ATMOSPHERE:-peaceful}" >> $GITHUB_OUTPUT
          echo "visual-style=${VISUAL_STYLE:-realistic}" >> $GITHUB_OUTPUT
          echo "color-palette=${COLOR_PALETTE:-natural}" >> $GITHUB_OUTPUT
          echo "lighting-quality=${LIGHTING_QUALITY:-natural}" >> $GITHUB_OUTPUT
          echo "movement-type=${MOVEMENT_TYPE:-medium}" >> $GITHUB_OUTPUT
          echo "camera-movement=${CAMERA_MOVEMENT:-steady}" >> $GITHUB_OUTPUT
          echo "pace=${PACE:-medium}" >> $GITHUB_OUTPUT
          echo "energy-level=${ENERGY_LEVEL:-5}" >> $GITHUB_OUTPUT
          echo "audio-type=${AUDIO_TYPE:-ambient}" >> $GITHUB_OUTPUT
          echo "audio-atmosphere=${AUDIO_ATMOSPHERE:-calm}" >> $GITHUB_OUTPUT
          echo "audio-quality=${AUDIO_QUALITY:-studio}" >> $GITHUB_OUTPUT
          echo "spatial-scale=${SPATIAL_SCALE:-room}" >> $GITHUB_OUTPUT
          echo "depth-perception=${DEPTH_PERCEPTION:-moderate}" >> $GITHUB_OUTPUT
          echo "time-period=${TIME_PERIOD:-contemporary}" >> $GITHUB_OUTPUT
          echo "duration-feel=${DURATION_FEEL:-medium}" >> $GITHUB_OUTPUT
          echo "content-genre=${CONTENT_GENRE:-narrative}" >> $GITHUB_OUTPUT
          echo "emotional-arc=${EMOTIONAL_ARC:-stable}" >> $GITHUB_OUTPUT
          echo "cultural-context=${CULTURAL_CONTEXT:-universal}" >> $GITHUB_OUTPUT
          echo "production-quality=${PRODUCTION_QUALITY:-professional}" >> $GITHUB_OUTPUT
          echo "technical-style=${TECHNICAL_STYLE:-polished}" >> $GITHUB_OUTPUT
          echo "confidence=${CONFIDENCE:-0.8}" >> $GITHUB_OUTPUT
        else
          echo "::error::‚ùå Video analysis JSON file not found"
          exit 1
        fi
        
        # ÂàÜÊûêÊñáÊõ∏„ÅÆÁ¢∫Ë™ç
        if [ -f "$ANALYSIS_DIR/video-analysis.md" ]; then
          echo "::notice::‚úÖ Video analysis document generated"
          echo "First 10 lines of analysis:"
          head -10 "$ANALYSIS_DIR/video-analysis.md"
        else
          echo "::warning::‚ö†Ô∏è Video analysis document not found"
        fi
        
        # ÊôÇÈñìÁöÑÂàÜÊûê„ÅÆÁ¢∫Ë™ç
        if [ -f "$ANALYSIS_DIR/temporal-analysis.srt" ]; then
          echo "::notice::‚úÖ Temporal analysis generated"
          echo "First 5 entries of temporal analysis:"
          head -15 "$ANALYSIS_DIR/temporal-analysis.srt"
        fi
        
        echo "completed=true" >> $GITHUB_OUTPUT
        
        echo "::endgroup::"
    
    - name: Commit and push analysis
      if: ${{ inputs.skip-commit != 'true' }}
      shell: bash
      env:
        GH_TOKEN: ${{ github.token }}
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add ${{ inputs.folder-name }}/
        if git diff --cached --quiet; then
          echo "No analysis files to commit"
        else
          git commit -m "Add video world analysis results"
          # Pull before push to handle concurrent commits
          for i in {1..3}; do
            git add . && git pull origin ${{ inputs.branch-name }} --rebase && git push origin ${{ inputs.branch-name }} && break
            echo "Push attempt $i failed, retrying in 5 seconds..."
            sleep 5
          done
        fi
    
    - name: Skip commit message
      if: ${{ inputs.skip-commit == 'true' }}
      shell: bash
      run: |
        echo "::notice::‚è≠Ô∏è Commit and push skipped for multimodal workflow"