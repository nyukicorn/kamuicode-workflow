name: 'Video World Analysis'
description: 'Analyze video content to extract comprehensive world characteristics for immersive experience'
author: 'KamuiCode Workflow'

inputs:
  # å‹•ç”»å…¥åŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°å½¢å¼å¯¾å¿œï¼‰
  video-prompt:
    description: 'Video content description'
    required: false
  video-url:
    description: 'URL to video file'
    required: false
  video-file:
    description: 'Path to local video file'
    required: false
  video-description:
    description: 'Detailed description of video content'
    required: false
  
  # å…±é€šè¨­å®š
  folder-name:
    description: 'The folder name for storing analysis files'
    required: true
  branch-name:
    description: 'The branch to work on'
    required: true
  oauth-token:
    description: 'Claude Code OAuth token'
    required: true

outputs:
  # è¦–è¦šçš„ç‰¹æ€§
  scene-type:
    description: 'Primary scene type (nature/urban/interior/fantasy/dramatic/etc.)'
    value: ${{ steps.analysis.outputs.scene-type }}
  atmosphere:
    description: 'Overall atmosphere (peaceful/energetic/mysterious/dramatic/etc.)'
    value: ${{ steps.analysis.outputs.atmosphere }}
  visual-style:
    description: 'Visual style (realistic/stylized/cinematic/documentary/etc.)'
    value: ${{ steps.analysis.outputs.visual-style }}
  color-palette:
    description: 'Dominant color palette (warm/cool/monochrome/vibrant/etc.)'
    value: ${{ steps.analysis.outputs.color-palette }}
  lighting-quality:
    description: 'Lighting quality (natural/artificial/dramatic/soft/etc.)'
    value: ${{ steps.analysis.outputs.lighting-quality }}
  
  # å‹•çš„ç‰¹æ€§
  movement-type:
    description: 'Type of movement (static/slow/dynamic/chaotic/rhythmic/etc.)'
    value: ${{ steps.analysis.outputs.movement-type }}
  camera-movement:
    description: 'Camera movement style (steady/handheld/smooth/tracking/etc.)'
    value: ${{ steps.analysis.outputs.camera-movement }}
  pace:
    description: 'Overall pace (slow/medium/fast/varied)'
    value: ${{ steps.analysis.outputs.pace }}
  energy-level:
    description: 'Energy level (1-10)'
    value: ${{ steps.analysis.outputs.energy-level }}
  
  # éŸ³éŸ¿ç‰¹æ€§
  audio-type:
    description: 'Audio type (music/dialogue/ambient/sound-effects/mixed/etc.)'
    value: ${{ steps.analysis.outputs.audio-type }}
  audio-atmosphere:
    description: 'Audio atmosphere (calm/intense/mysterious/uplifting/etc.)'
    value: ${{ steps.analysis.outputs.audio-atmosphere }}
  audio-quality:
    description: 'Audio quality (studio/live/ambient/processed/etc.)'
    value: ${{ steps.analysis.outputs.audio-quality }}
  
  # ç©ºé–“ãƒ»æ™‚é–“ç‰¹æ€§
  spatial-scale:
    description: 'Spatial scale (intimate/room/building/landscape/cosmic/etc.)'
    value: ${{ steps.analysis.outputs.spatial-scale }}
  depth-perception:
    description: 'Depth perception (flat/moderate/deep/immersive)'
    value: ${{ steps.analysis.outputs.depth-perception }}
  time-period:
    description: 'Time period (historical/contemporary/futuristic/timeless)'
    value: ${{ steps.analysis.outputs.time-period }}
  duration-feel:
    description: 'Duration feeling (brief/extended/epic/cyclical/etc.)'
    value: ${{ steps.analysis.outputs.duration-feel }}
  
  # å†…å®¹ãƒ»ãƒ†ãƒ¼ãƒžç‰¹æ€§
  content-genre:
    description: 'Content genre (documentary/narrative/abstract/educational/etc.)'
    value: ${{ steps.analysis.outputs.content-genre }}
  emotional-arc:
    description: 'Emotional arc (stable/building/climactic/varied/etc.)'
    value: ${{ steps.analysis.outputs.emotional-arc }}
  cultural-context:
    description: 'Cultural context (western/eastern/universal/specific/etc.)'
    value: ${{ steps.analysis.outputs.cultural-context }}
  
  # æŠ€è¡“ãƒ»å“è³ªç‰¹æ€§
  production-quality:
    description: 'Production quality (professional/amateur/artistic/experimental/etc.)'
    value: ${{ steps.analysis.outputs.production-quality }}
  technical-style:
    description: 'Technical style (polished/raw/stylized/naturalistic/etc.)'
    value: ${{ steps.analysis.outputs.technical-style }}
  
  # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  analysis-completed:
    description: 'Whether analysis was completed successfully'
    value: ${{ steps.analysis.outputs.completed }}
  confidence:
    description: 'Analysis confidence score (0.0-1.0)'
    value: ${{ steps.analysis.outputs.confidence }}

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.branch-name }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Claude Code SDK
      shell: bash
      run: npm install @anthropic-ai/claude-code
    
    - name: å‹•ç”»ä¸–ç•Œè¦³åˆ†æžã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
      id: analysis
      shell: bash
      env:
        CLAUDE_CODE_OAUTH_TOKEN: ${{ inputs.oauth-token }}
      run: |
        echo "::group::ðŸŽ¬ Video World Analysis Agent Execution"
        echo "Starting at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
        
        # è¨­å®š
        FOLDER_NAME="${{ inputs.folder-name }}"
        ANALYSIS_DIR="$FOLDER_NAME/world-analysis"
        
        echo "Analysis folder: $ANALYSIS_DIR"
        
        # åˆ†æžãƒ•ã‚©ãƒ«ãƒ€ã‚’äº‹å‰ã«ä½œæˆ
        if [ ! -d "$ANALYSIS_DIR" ]; then
          mkdir -p "$ANALYSIS_DIR"
          echo "ðŸ“ Created analysis folder: $ANALYSIS_DIR"
        fi
        
        # å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã¨æ•´ç†
        VIDEO_PROMPT="${{ inputs.video-prompt }}"
        VIDEO_URL="${{ inputs.video-url }}"
        VIDEO_FILE="${{ inputs.video-file }}"
        VIDEO_DESCRIPTION="${{ inputs.video-description }}"
        
        echo "Input validation:"
        echo "- Video prompt: ${VIDEO_PROMPT:+provided}"
        echo "- Video URL: ${VIDEO_URL:+provided}"
        echo "- Video file: ${VIDEO_FILE:+provided}"
        echo "- Video description: ${VIDEO_DESCRIPTION:+provided}"
        
        # å…¥åŠ›æ¤œè¨¼
        INPUT_COUNT=0
        INPUT_TYPE=""
        
        if [ -n "$VIDEO_PROMPT" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="prompt"
          echo "âœ… Using video prompt input"
        fi
        
        if [ -n "$VIDEO_URL" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="url"
          echo "âœ… Using video URL input"
        fi
        
        if [ -n "$VIDEO_FILE" ] && [ -f "$VIDEO_FILE" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="file"
          echo "âœ… Using video file input: $VIDEO_FILE"
        fi
        
        if [ -n "$VIDEO_DESCRIPTION" ]; then
          INPUT_COUNT=$((INPUT_COUNT + 1))
          INPUT_TYPE="description"
          echo "âœ… Using video description input"
        fi
        
        if [ "$INPUT_COUNT" -eq 0 ]; then
          echo "::error::âŒ No video input provided"
          exit 1
        fi
        
        if [ "$INPUT_COUNT" -gt 1 ]; then
          echo "::warning::âš ï¸ Multiple video inputs provided, using first available"
        fi
        
        # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰
        PROMPT="ã‚ãªãŸã¯å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ†æžã‹ã‚‰ç·åˆçš„ãªä¸–ç•Œè¦³ç‰¹æ€§ã‚’æŠ½å‡ºã™ã‚‹å°‚é–€å®¶ã§ã™ã€‚"
        
        if [ -n "$VIDEO_PROMPT" ]; then
          PROMPT="$PROMPT
        
        **å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„èª¬æ˜Ž**:
        $VIDEO_PROMPT"
        elif [ -n "$VIDEO_DESCRIPTION" ]; then
          PROMPT="$PROMPT
        
        **å‹•ç”»è©³ç´°èª¬æ˜Ž**:
        $VIDEO_DESCRIPTION"
        elif [ -n "$VIDEO_URL" ]; then
          PROMPT="$PROMPT
        
        **å‹•ç”»URL**: $VIDEO_URL
        (URLã‹ã‚‰å‹•ç”»å†…å®¹ã‚’åˆ†æžã—ã¦ãã ã•ã„)"
        elif [ -n "$VIDEO_FILE" ]; then
          PROMPT="$PROMPT
        
        **å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«**: $VIDEO_FILE
        (ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‹•ç”»å†…å®¹ã‚’åˆ†æžã—ã¦ãã ã•ã„)"
        fi
        
        PROMPT="$PROMPT
        
        **åˆ†æžã‚¿ã‚¹ã‚¯**:
        å‹•ç”»ã®è¦–è¦šãƒ»è´è¦šãƒ»æ™‚é–“çš„ç‰¹æ€§ã‚’åŒ…æ‹¬çš„ã«åˆ†æžã—ã€3Dä½“é¨“ã‚„ä¸–ç•Œè¦³æ§‹ç¯‰ã«æ´»ç”¨ã§ãã‚‹ç‰¹æ€§ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
        
        **åˆ†æžè¦ç´ **:
        1. **è¦–è¦šçš„ç‰¹æ€§**:
           - scene_type: ä¸»è¦ã‚·ãƒ¼ãƒ³ã‚¿ã‚¤ãƒ—ï¼ˆnature/urban/interior/fantasy/dramatic/etc.ï¼‰
           - atmosphere: å…¨ä½“çš„é›°å›²æ°—ï¼ˆpeaceful/energetic/mysterious/dramatic/etc.ï¼‰
           - visual_style: è¦–è¦šã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆrealistic/stylized/cinematic/documentary/etc.ï¼‰
           - color_palette: æ”¯é…çš„ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆwarm/cool/monochrome/vibrant/etc.ï¼‰
           - lighting_quality: ç…§æ˜Žå“è³ªï¼ˆnatural/artificial/dramatic/soft/etc.ï¼‰
        
        2. **å‹•çš„ç‰¹æ€§**:
           - movement_type: å‹•ãã®ã‚¿ã‚¤ãƒ—ï¼ˆstatic/slow/dynamic/chaotic/rhythmic/etc.ï¼‰
           - camera_movement: ã‚«ãƒ¡ãƒ©å‹•ä½œã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆsteady/handheld/smooth/tracking/etc.ï¼‰
           - pace: å…¨ä½“çš„ãƒšãƒ¼ã‚¹ï¼ˆslow/medium/fast/variedï¼‰
           - energy_level: ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¬ãƒ™ãƒ«ï¼ˆ1-10ï¼‰
        
        3. **éŸ³éŸ¿ç‰¹æ€§**:
           - audio_type: éŸ³å£°ã‚¿ã‚¤ãƒ—ï¼ˆmusic/dialogue/ambient/sound-effects/mixed/etc.ï¼‰
           - audio_atmosphere: éŸ³å£°é›°å›²æ°—ï¼ˆcalm/intense/mysterious/uplifting/etc.ï¼‰
           - audio_quality: éŸ³å£°å“è³ªï¼ˆstudio/live/ambient/processed/etc.ï¼‰
        
        4. **ç©ºé–“ãƒ»æ™‚é–“ç‰¹æ€§**:
           - spatial_scale: ç©ºé–“ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆintimate/room/building/landscape/cosmic/etc.ï¼‰
           - depth_perception: å¥¥è¡ŒãçŸ¥è¦šï¼ˆflat/moderate/deep/immersiveï¼‰
           - time_period: æ™‚ä»£ï¼ˆhistorical/contemporary/futuristic/timelessï¼‰
           - duration_feel: æŒç¶šæ„Ÿï¼ˆbrief/extended/epic/cyclical/etc.ï¼‰
        
        5. **å†…å®¹ãƒ»ãƒ†ãƒ¼ãƒžç‰¹æ€§**:
           - content_genre: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆdocumentary/narrative/abstract/educational/etc.ï¼‰
           - emotional_arc: æ„Ÿæƒ…ã‚¢ãƒ¼ã‚¯ï¼ˆstable/building/climactic/varied/etc.ï¼‰
           - cultural_context: æ–‡åŒ–çš„æ–‡è„ˆï¼ˆwestern/eastern/universal/specific/etc.ï¼‰
        
        6. **æŠ€è¡“ãƒ»å“è³ªç‰¹æ€§**:
           - production_quality: åˆ¶ä½œå“è³ªï¼ˆprofessional/amateur/artistic/experimental/etc.ï¼‰
           - technical_style: æŠ€è¡“ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆpolished/raw/stylized/naturalistic/etc.ï¼‰
        
        **æ™‚é–“çš„å¤‰åŒ–ã®åˆ†æž**:
        å‹•ç”»ã®å ´åˆã€æ™‚é–“çµŒéŽã«ä¼´ã†å¤‰åŒ–ã‚‚é‡è¦ã§ã™ã€‚ä¸»è¦ãªè»¢æ›ç‚¹ã‚„æ„Ÿæƒ…ã®å¤‰åŒ–ãŒã‚ã‚Œã°ã€
        **$ANALYSIS_DIR/temporal-analysis.srt** ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ä½œæˆã—ã¦ãã ã•ã„ã€‚
        
        **å¿…é ˆå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«**:
        1. **$ANALYSIS_DIR/video-analysis.json** - æ§‹é€ åŒ–ã•ã‚ŒãŸåˆ†æžçµæžœ
        2. **$ANALYSIS_DIR/video-analysis.md** - è©³ç´°åˆ†æžãƒ¬ãƒãƒ¼ãƒˆ
        3. **$ANALYSIS_DIR/video-summary.txt** - 1è¡Œè¦ç´„
        4. **$ANALYSIS_DIR/temporal-analysis.srt** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) - æ™‚é–“çš„å¤‰åŒ–åˆ†æž
        
        **JSONãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ**:
        \`\`\`json
        {
          \"scene_type\": \"nature\",
          \"atmosphere\": \"peaceful\",
          \"visual_style\": \"cinematic\",
          \"color_palette\": \"warm\",
          \"lighting_quality\": \"natural\",
          \"movement_type\": \"slow\",
          \"camera_movement\": \"smooth\",
          \"pace\": \"slow\",
          \"energy_level\": 4,
          \"audio_type\": \"ambient\",
          \"audio_atmosphere\": \"calm\",
          \"audio_quality\": \"studio\",
          \"spatial_scale\": \"landscape\",
          \"depth_perception\": \"deep\",
          \"time_period\": \"contemporary\",
          \"duration_feel\": \"extended\",
          \"content_genre\": \"documentary\",
          \"emotional_arc\": \"stable\",
          \"cultural_context\": \"universal\",
          \"production_quality\": \"professional\",
          \"technical_style\": \"polished\",
          \"confidence\": 0.9,
          \"input_type\": \"$INPUT_TYPE\",
          \"analysis_timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"
        }
        \`\`\`
        
        **é‡è¦ãªæ³¨æ„ç‚¹**:
        1. å…¨ã¦ã®å€¤ã¯æŒ‡å®šã•ã‚ŒãŸé¸æŠžè‚¢ã¾ãŸã¯æ•°å€¤ç¯„å›²å†…ã§è¨­å®šã—ã¦ãã ã•ã„
        2. è¦–è¦šã¨è´è¦šã®ä¸¡æ–¹ã®è¦ç´ ã‚’ç·åˆçš„ã«è€ƒæ…®ã—ã¦ãã ã•ã„
        3. å‹•ç”»ã®æ™‚é–“çš„å±•é–‹ã‚‚åˆ†æžã«å«ã‚ã¦ãã ã•ã„
        4. 3Dä½“é¨“ã‚„ä¸–ç•Œè¦³æ§‹ç¯‰ã¸ã®é©ç”¨å¯èƒ½æ€§ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„
        5. ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå¾Œã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèªãƒ»å ±å‘Šã—ã¦ãã ã•ã„"
        
        echo "ðŸš€ Starting Video World Analysis Agent Claude Code CLI..."
        echo "ðŸ“ Prompt length: ${#PROMPT}"
        
        # Claude Code CLIã®å®Ÿè¡Œ
        npx @anthropic-ai/claude-code \
          --allowedTools "Read,Write,Edit,Bash" \
          --max-turns 20 \
          --verbose \
          --permission-mode "bypassPermissions" \
          -p "$PROMPT" || {
            echo "::error::âŒ Claude Code CLI execution failed"
            exit 1
          }
        
        # ç”Ÿæˆã•ã‚ŒãŸåˆ†æžçµæžœã®ç¢ºèªã¨å‡ºåŠ›è¨­å®š
        echo ""
        echo "ðŸ“‹ Checking generated analysis files..."
        
        # JSONåˆ†æžçµæžœã®ç¢ºèªã¨å‡ºåŠ›è¨­å®š
        if [ -f "$ANALYSIS_DIR/video-analysis.json" ]; then
          echo "::notice::âœ… Video analysis JSON generated"
          
          # JSONã‹ã‚‰å€¤ã‚’æŠ½å‡ºã—ã¦GitHub Outputã«è¨­å®š
          SCENE_TYPE=$(grep -o '"scene_type"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          ATMOSPHERE=$(grep -o '"atmosphere"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          VISUAL_STYLE=$(grep -o '"visual_style"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          COLOR_PALETTE=$(grep -o '"color_palette"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          LIGHTING_QUALITY=$(grep -o '"lighting_quality"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          MOVEMENT_TYPE=$(grep -o '"movement_type"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CAMERA_MOVEMENT=$(grep -o '"camera_movement"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          PACE=$(grep -o '"pace"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          ENERGY_LEVEL=$(grep -o '"energy_level"[[:space:]]*:[[:space:]]*[0-9]*' "$ANALYSIS_DIR/video-analysis.json" | cut -d':' -f2 | tr -d ' ')
          AUDIO_TYPE=$(grep -o '"audio_type"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          AUDIO_ATMOSPHERE=$(grep -o '"audio_atmosphere"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          AUDIO_QUALITY=$(grep -o '"audio_quality"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          SPATIAL_SCALE=$(grep -o '"spatial_scale"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          DEPTH_PERCEPTION=$(grep -o '"depth_perception"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          TIME_PERIOD=$(grep -o '"time_period"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          DURATION_FEEL=$(grep -o '"duration_feel"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CONTENT_GENRE=$(grep -o '"content_genre"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          EMOTIONAL_ARC=$(grep -o '"emotional_arc"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CULTURAL_CONTEXT=$(grep -o '"cultural_context"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          PRODUCTION_QUALITY=$(grep -o '"production_quality"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          TECHNICAL_STYLE=$(grep -o '"technical_style"[[:space:]]*:[[:space:]]*"[^"]*"' "$ANALYSIS_DIR/video-analysis.json" | cut -d'"' -f4)
          CONFIDENCE=$(grep -o '"confidence"[[:space:]]*:[[:space:]]*[0-9.]*' "$ANALYSIS_DIR/video-analysis.json" | cut -d':' -f2 | tr -d ' ')
          
          echo "Scene type: $SCENE_TYPE"
          echo "Atmosphere: $ATMOSPHERE"
          echo "Visual style: $VISUAL_STYLE"
          echo "Color palette: $COLOR_PALETTE"
          echo "Lighting quality: $LIGHTING_QUALITY"
          echo "Movement type: $MOVEMENT_TYPE"
          echo "Camera movement: $CAMERA_MOVEMENT"
          echo "Pace: $PACE"
          echo "Energy level: $ENERGY_LEVEL"
          echo "Audio type: $AUDIO_TYPE"
          echo "Audio atmosphere: $AUDIO_ATMOSPHERE"
          echo "Audio quality: $AUDIO_QUALITY"
          echo "Spatial scale: $SPATIAL_SCALE"
          echo "Depth perception: $DEPTH_PERCEPTION"
          echo "Time period: $TIME_PERIOD"
          echo "Duration feel: $DURATION_FEEL"
          echo "Content genre: $CONTENT_GENRE"
          echo "Emotional arc: $EMOTIONAL_ARC"
          echo "Cultural context: $CULTURAL_CONTEXT"
          echo "Production quality: $PRODUCTION_QUALITY"
          echo "Technical style: $TECHNICAL_STYLE"
          echo "Analysis confidence: $CONFIDENCE"
          
          # GitHub Outputã«è¨­å®š
          echo "scene-type=${SCENE_TYPE:-nature}" >> $GITHUB_OUTPUT
          echo "atmosphere=${ATMOSPHERE:-peaceful}" >> $GITHUB_OUTPUT
          echo "visual-style=${VISUAL_STYLE:-realistic}" >> $GITHUB_OUTPUT
          echo "color-palette=${COLOR_PALETTE:-natural}" >> $GITHUB_OUTPUT
          echo "lighting-quality=${LIGHTING_QUALITY:-natural}" >> $GITHUB_OUTPUT
          echo "movement-type=${MOVEMENT_TYPE:-medium}" >> $GITHUB_OUTPUT
          echo "camera-movement=${CAMERA_MOVEMENT:-steady}" >> $GITHUB_OUTPUT
          echo "pace=${PACE:-medium}" >> $GITHUB_OUTPUT
          echo "energy-level=${ENERGY_LEVEL:-5}" >> $GITHUB_OUTPUT
          echo "audio-type=${AUDIO_TYPE:-ambient}" >> $GITHUB_OUTPUT
          echo "audio-atmosphere=${AUDIO_ATMOSPHERE:-calm}" >> $GITHUB_OUTPUT
          echo "audio-quality=${AUDIO_QUALITY:-studio}" >> $GITHUB_OUTPUT
          echo "spatial-scale=${SPATIAL_SCALE:-room}" >> $GITHUB_OUTPUT
          echo "depth-perception=${DEPTH_PERCEPTION:-moderate}" >> $GITHUB_OUTPUT
          echo "time-period=${TIME_PERIOD:-contemporary}" >> $GITHUB_OUTPUT
          echo "duration-feel=${DURATION_FEEL:-medium}" >> $GITHUB_OUTPUT
          echo "content-genre=${CONTENT_GENRE:-narrative}" >> $GITHUB_OUTPUT
          echo "emotional-arc=${EMOTIONAL_ARC:-stable}" >> $GITHUB_OUTPUT
          echo "cultural-context=${CULTURAL_CONTEXT:-universal}" >> $GITHUB_OUTPUT
          echo "production-quality=${PRODUCTION_QUALITY:-professional}" >> $GITHUB_OUTPUT
          echo "technical-style=${TECHNICAL_STYLE:-polished}" >> $GITHUB_OUTPUT
          echo "confidence=${CONFIDENCE:-0.8}" >> $GITHUB_OUTPUT
        else
          echo "::error::âŒ Video analysis JSON file not found"
          exit 1
        fi
        
        # åˆ†æžæ–‡æ›¸ã®ç¢ºèª
        if [ -f "$ANALYSIS_DIR/video-analysis.md" ]; then
          echo "::notice::âœ… Video analysis document generated"
          echo "First 10 lines of analysis:"
          head -10 "$ANALYSIS_DIR/video-analysis.md"
        else
          echo "::warning::âš ï¸ Video analysis document not found"
        fi
        
        # æ™‚é–“çš„åˆ†æžã®ç¢ºèª
        if [ -f "$ANALYSIS_DIR/temporal-analysis.srt" ]; then
          echo "::notice::âœ… Temporal analysis generated"
          echo "First 5 entries of temporal analysis:"
          head -15 "$ANALYSIS_DIR/temporal-analysis.srt"
        fi
        
        echo "completed=true" >> $GITHUB_OUTPUT
        
        echo "::endgroup::"
    
    - name: Commit and push analysis
      shell: bash
      env:
        GH_TOKEN: ${{ github.token }}
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add ${{ inputs.folder-name }}/
        if git diff --cached --quiet; then
          echo "No analysis files to commit"
        else
          git commit -m "Add video world analysis results"
          # Pull before push to handle concurrent commits
          for i in {1..3}; do
            git pull origin ${{ inputs.branch-name }} --rebase && git push origin ${{ inputs.branch-name }} && break
            echo "Push attempt $i failed, retrying in 5 seconds..."
            sleep 5
          done
        fi