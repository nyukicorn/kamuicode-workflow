name: 'Three.js Scene Generation'
description: 'Generate Three.js 3D scenes with panorama and particles using Three.js MCP'
author: 'KamuiCode Workflow'

inputs:
  experience-concept:
    description: 'The 3D experience concept'
    required: true
  panorama-image-url:
    description: 'Google URL of the panorama image'
    required: false
  background-type:
    description: 'Background type (panorama/solid_black/solid_white/transparent/gradient)'
    required: false
    default: 'panorama'
  art-mode:
    description: 'Art creation mode (none/sculptural/organic/geometric/abstract)'
    required: false
    default: 'none'
  art-object-type:
    description: 'Type of 3D art object to create'
    required: false
  complexity-level:
    description: 'Complexity level (simple/medium/complex/masterpiece)'
    required: false
    default: 'medium'
  include-music:
    description: 'Whether to include music controls'
    required: false
    default: 'false'
  music-url:
    description: 'Google URL of the background music (if applicable)'
    required: false
  particle-enabled:
    description: 'Whether to enable particle effects'
    required: false
    default: 'true'
  particle-config:
    description: 'Particle configuration (count:size:shape:corner_radius)'
    required: false
    default: '1000:0.5:circle:0.0'
  folder-name:
    description: 'The folder name for storing Three.js files'
    required: true
  branch-name:
    description: 'The branch to work on'
    required: true
  oauth-token:
    description: 'Claude Code OAuth token'
    required: true

outputs:
  threejs-completed:
    description: 'Whether Three.js scene generation was completed successfully'
    value: ${{ steps.threejs.outputs.completed }}
  scene-files-created:
    description: 'Number of scene files created'
    value: ${{ steps.threejs.outputs.scene-files-created }}

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.branch-name }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Claude Code SDK
      shell: bash
      run: npm install @anthropic-ai/claude-code
    
    - name: Three.js Scene Generation Agent
      id: threejs
      shell: bash
      env:
        CLAUDE_CODE_OAUTH_TOKEN: ${{ inputs.oauth-token }}
      run: |
        echo "::group::ðŸŽ¨ Three.js Scene Generation"
        echo "Starting at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
        
        # è¨­å®š
        EXPERIENCE_CONCEPT="${{ inputs.experience-concept }}"
        PANORAMA_URL="${{ inputs.panorama-image-url }}"
        BACKGROUND_TYPE="${{ inputs.background-type }}"
        ART_MODE="${{ inputs.art-mode }}"
        ART_OBJECT_TYPE="${{ inputs.art-object-type }}"
        COMPLEXITY_LEVEL="${{ inputs.complexity-level }}"
        INCLUDE_MUSIC="${{ inputs.include-music }}"
        MUSIC_URL="${{ inputs.music-url }}"
        PARTICLE_ENABLED="${{ inputs.particle-enabled }}"
        PARTICLE_CONFIG="${{ inputs.particle-config }}"
        
        # ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¨­å®šã‚’ãƒ‘ãƒ¼ã‚¹ (count:size:shape:corner_radius)
        IFS=':' read -r PARTICLE_COUNT PARTICLE_SIZE PARTICLE_SHAPE PARTICLE_CORNER_RADIUS <<< "$PARTICLE_CONFIG"
        PARTICLE_COLOR_MODE="gradient"
        PARTICLE_BASE_COLOR="#FFFFFF"
        FOLDER_NAME="${{ inputs.folder-name }}"
        SRC_DIR="$FOLDER_NAME/src"
        ASSETS_DIR="$FOLDER_NAME/assets"
        
        echo "Experience concept: $EXPERIENCE_CONCEPT"
        echo "Background type: $BACKGROUND_TYPE"
        echo "Art mode: $ART_MODE"
        echo "Art object type: $ART_OBJECT_TYPE"
        echo "Complexity level: $COMPLEXITY_LEVEL"
        echo "Panorama URL: $PANORAMA_URL"
        echo "Include music: $INCLUDE_MUSIC"
        echo "Particle enabled: $PARTICLE_ENABLED"
        echo "Particle config: $PARTICLE_CONFIG"
        echo "  - Particle count: $PARTICLE_COUNT"
        echo "  - Particle size: $PARTICLE_SIZE"
        echo "  - Particle shape: $PARTICLE_SHAPE"
        echo "  - Particle corner radius: $PARTICLE_CORNER_RADIUS"
        echo "Target folders: $SRC_DIR, $ASSETS_DIR"
        
        # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’äº‹å‰ã«ä½œæˆ
        mkdir -p "$SRC_DIR/js"
        mkdir -p "$SRC_DIR/css"
        mkdir -p "$SRC_DIR/libs"
        mkdir -p "$ASSETS_DIR"
        echo "ðŸ“ Created directory structure"
        
        # Three.js MCPè¨­å®šã®ç¢ºèª
        MCP_CONFIG_PATH=".claude/mcp-threejs.json"
        MCP_CONFIG_ABS_PATH="$(pwd)/$MCP_CONFIG_PATH"
        
        echo "ðŸ“‹ Three.js MCP Configuration Check:"
        echo "Working directory: $(pwd)"
        echo "MCP config path: $MCP_CONFIG_PATH"
        echo "MCP config absolute path: $MCP_CONFIG_ABS_PATH"
        
        # Three.js MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
        if [ ! -f "$MCP_CONFIG_ABS_PATH" ]; then
          echo "Creating Three.js MCP configuration..."
          mkdir -p .claude
          cat > "$MCP_CONFIG_ABS_PATH" << 'EOF'
        {
          "mcpServers": {
            "threejs": {
              "type": "http",
              "url": "https://www.pulsemcp.com/servers/locchung-three-js",
              "description": "Three.js MCP Server by Loc Chung for 3D scene manipulation"
            }
          }
        }
        EOF
          echo "âœ… Three.js MCP config file created"
        else
          echo "âœ… Three.js MCP config file already exists"
        fi
        
        # èƒŒæ™¯è¨­å®šã®æ§‹ç¯‰
        BACKGROUND_INTEGRATION=""
        if [ "$BACKGROUND_TYPE" == "panorama" ]; then
          BACKGROUND_INTEGRATION="
        **èƒŒæ™¯è¨­å®šï¼ˆãƒ‘ãƒŽãƒ©ãƒžï¼‰**:
        - ãƒ‘ãƒŽãƒ©ãƒžç”»åƒURL: $PANORAMA_URL
        - ãƒ‘ãƒŽãƒ©ãƒžç”»åƒã‚’$ASSETS_DIR/panorama.jpgã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¿å­˜
        - ãƒ‘ãƒŽãƒ©ãƒžç”»åƒã‚’$SRC_DIR/panorama.jpgã«ã‚‚ã‚³ãƒ”ãƒ¼ï¼ˆç›¸å¯¾ãƒ‘ã‚¹å•é¡Œè§£æ±ºï¼‰
        - çƒä½“ã‚¸ã‚ªãƒ¡ãƒˆãƒªã«ãƒžãƒƒãƒ”ãƒ³ã‚°"
        elif [ "$BACKGROUND_TYPE" == "solid_black" ]; then
          BACKGROUND_INTEGRATION="
        **èƒŒæ™¯è¨­å®šï¼ˆé»’èƒŒæ™¯ï¼‰**:
        - ç´”ç²‹ãªé»’èƒŒæ™¯ï¼ˆ#000000ï¼‰
        - ãƒ‘ãƒŽãƒ©ãƒžç”»åƒå‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
        - 3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»ã‚¢ãƒ¼ãƒˆä½œå“ã«æœ€é©åŒ–"
        elif [ "$BACKGROUND_TYPE" == "solid_white" ]; then
          BACKGROUND_INTEGRATION="
        **èƒŒæ™¯è¨­å®šï¼ˆç™½èƒŒæ™¯ï¼‰**:
        - ç´”ç²‹ãªç™½èƒŒæ™¯ï¼ˆ#FFFFFFï¼‰
        - ãƒ‘ãƒŽãƒ©ãƒžç”»åƒå‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
        - å±•ç¤ºãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨"
        elif [ "$BACKGROUND_TYPE" == "transparent" ]; then
          BACKGROUND_INTEGRATION="
        **èƒŒæ™¯è¨­å®šï¼ˆé€æ˜ŽèƒŒæ™¯ï¼‰**:
        - é€æ˜ŽèƒŒæ™¯ï¼ˆalpha=0ï¼‰
        - ãƒ‘ãƒŽãƒ©ãƒžç”»åƒå‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
        - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå˜ä½“è¡¨ç¤ºç”¨"
        elif [ "$BACKGROUND_TYPE" == "gradient" ]; then
          BACKGROUND_INTEGRATION="
        **èƒŒæ™¯è¨­å®šï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰**:
        - ç¾Žã—ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯
        - ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«åŸºã¥ã„ãŸè‰²èª¿é¸æŠž
        - ã‚¢ãƒ¼ãƒˆä½œå“ã«é©ã—ãŸé…è‰²"
        fi
        
        # 3Dã‚¢ãƒ¼ãƒˆè¨­å®šã®æ§‹ç¯‰
        ART_INTEGRATION=""
        if [ "$ART_MODE" != "none" ] && [ -n "$ART_OBJECT_TYPE" ]; then
          ART_INTEGRATION="
        **3Dã‚¢ãƒ¼ãƒˆä½œå“ç”Ÿæˆ**:
        - ã‚¢ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰: $ART_MODE
        - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—: $ART_OBJECT_TYPE
        - è¤‡é›‘ã•ãƒ¬ãƒ™ãƒ«: $COMPLEXITY_LEVEL
        - ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«3Dã‚¸ã‚ªãƒ¡ãƒˆãƒªç”Ÿæˆ
        - é«˜åº¦ãªæè³ªãƒ»ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°åŠ¹æžœ
        - ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«åŸºã¥ã„ãŸèŠ¸è¡“çš„è¡¨ç¾"
        fi
        
        # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰
        MUSIC_INTEGRATION=""
        if [ "$INCLUDE_MUSIC" == "true" ] && [ -n "$MUSIC_URL" ]; then
          MUSIC_INTEGRATION="
        **éŸ³æ¥½çµ±åˆ**:
        - BGM URL: $MUSIC_URL
        - HTML5 Audioã§ã®éŸ³æ¥½ã‚ªãƒ³/ã‚ªãƒ•ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…
        - ãƒ«ãƒ¼ãƒ—å†ç”Ÿã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ åˆ¶å¾¡æ©Ÿèƒ½
        - éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’$SRC_DIR/generated-music.wavã«ã‚³ãƒ”ãƒ¼"
        fi
        
        # ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¨­å®šã®æ§‹ç¯‰
        PARTICLE_INTEGRATION=""
        if [ "$PARTICLE_ENABLED" == "true" ]; then
          PARTICLE_INTEGRATION="
        **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¨­å®š**:
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°: $PARTICLE_COUNTå€‹
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚µã‚¤ã‚º: $PARTICLE_SIZE
        - å½¢çŠ¶: $PARTICLE_SHAPEï¼ˆå›ºå®šã€åˆæœŸè¨­å®šã®ã¿ï¼‰
        - è§’ã®ä¸¸ã¿: $PARTICLE_CORNER_RADIUSï¼ˆsquareã®å ´åˆã®ã¿é©ç”¨ï¼‰
        - è‰²ãƒ¢ãƒ¼ãƒ‰: $PARTICLE_COLOR_MODEï¼ˆsingle/gradient/rainbowï¼‰
        - ãƒ™ãƒ¼ã‚¹è‰²: $PARTICLE_BASE_COLOR
        - æè³ª: PointsMaterialï¼ˆè‰²å¤‰æ›´å¯¾å¿œï¼‰
        - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: è‡ªå‹•å›žè»¢æ™‚ã«é«˜é€ŸåŒ–
        - è‰²å®Ÿè£…: æ”¹å–„ç‰ˆç¾Žã—ã„è‰²å¤‰æ›´UIï¼ˆå³ç«¯ç¸¦åž‹ã€ãƒžã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤ºã€ç¾Žã—ã„åŒç³»è‰²/å¤šå½©è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        - ãƒ†ãƒ¼ãƒžé€£å‹•: experience_conceptå†…å®¹ã«åŸºã¥ã„ã¦ç¾Žã—ã„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®è‰²èª¿ã‚„å‹•ãã‚’è‡ªå‹•èª¿æ•´"
        else
          PARTICLE_INTEGRATION="
        **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¨­å®š**:
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æžœ: ç„¡åŠ¹
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¹ã‚­ãƒƒãƒ—"
        fi
        
        PROMPT="é«˜åº¦ãªThree.js 3Dã‚¢ãƒ¼ãƒˆä½“é¨“ã‚·ãƒ¼ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

        **ä½“é¨“ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**: ç¾Žã—ã„$EXPERIENCE_CONCEPT
        **èƒŒæ™¯ã‚¿ã‚¤ãƒ—**: $BACKGROUND_TYPE
        **ã‚¢ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰**: $ART_MODE
        
        **ãƒ†ãƒ¼ãƒžé€£å‹•å®Ÿè£…**:
        - ã‚³ãƒ³ã‚»ãƒ—ãƒˆå†…å®¹ã‚’è§£æžã—ã¦ç¾Žã—ã„3Dç©ºé–“ã‚’æ§‹ç¯‰
        - ã‚¢ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸé«˜åº¦ãª3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
        - èƒŒæ™¯ã‚¿ã‚¤ãƒ—ã«æœ€é©åŒ–ã•ã‚ŒãŸè¦–è¦šåŠ¹æžœ
        - ä¾‹: ã€Œæ¡œã€â†’ç¾Žã—ã„ãƒ”ãƒ³ã‚¯ç³»è‰²èª¿ã€ã€Œæµ·ã€â†’ç¾Žã—ã„é’ç³»è‰²èª¿ã€ã€Œå¤œã€â†’ç¾Žã—ã„æš—ã‚ãƒˆãƒ¼ãƒ³
        
        $BACKGROUND_INTEGRATION
        
        $ART_INTEGRATION
        
        **å¿…é ˆå®Ÿè¡Œæ‰‹é †**:
        1. **ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ï¼ˆé‡è¦ï¼‰**:
           - èƒŒæ™¯ãŒãƒ‘ãƒŽãƒ©ãƒžã®å ´åˆã®ã¿ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»é…ç½®
           - éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°$SRC_DIR/generated-music.wavã«ã‚‚ã‚³ãƒ”ãƒ¼
        
        2. **å˜ä¸€HTMLãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆ$SRC_DIR/index.htmlï¼‰**:
           - Three.js CDNä½¿ç”¨: https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js
           - OrbitControlsä½¿ç”¨ç¦æ­¢ï¼ˆã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…å¿…é ˆï¼‰
           - å®Œå…¨ãªHTML5 Audioå®Ÿè£…
           - ã‚«ã‚¹ã‚¿ãƒ ãƒžã‚¦ã‚¹/ã‚¿ãƒƒãƒåˆ¶å¾¡
           - è‡ªå‹•å›žè»¢æ©Ÿèƒ½ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼‰
           - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
        
        **å¿…é ˆå®Ÿè£…æ©Ÿèƒ½**:
        - **ãƒžã‚¦ã‚¹åˆ¶å¾¡**: ãƒ‰ãƒ©ãƒƒã‚°ã§è¦–ç‚¹ç§»å‹•ã€ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ 
        - **ã‚¿ãƒƒãƒåˆ¶å¾¡**: ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®ã‚¿ãƒƒãƒæ“ä½œ
        - **è‡ªå‹•å›žè»¢**: ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§æ™‚è¨ˆå›žã‚Šè‡ªå‹•å›žè»¢ãƒ¢ãƒ¼ãƒ‰
        - **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«**: å½¢çŠ¶é¸æŠžå¯èƒ½ï¼ˆ$PARTICLE_SHAPEï¼‰ã€ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºå¯èƒ½
          - circle: CircleGeometryä½¿ç”¨
          - square: PlaneGeometry + è§’ä¸¸ã¿å®Ÿè£…ï¼ˆcorner_radius=$PARTICLE_CORNER_RADIUSï¼‰
          - triangle: ã‚«ã‚¹ã‚¿ãƒ ä¸‰è§’å½¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªï¼ˆé ‚ç‚¹3ã¤ã§æ§‹æˆï¼‰
          - star: ã‚«ã‚¹ã‚¿ãƒ æ˜Ÿå½¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªï¼ˆ5ã¤ã®å°–ã£ãŸé ‚ç‚¹ï¼‰
          - heart: ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒˆå½¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªï¼ˆæ•°å­¦çš„ãƒãƒ¼ãƒˆæ›²ç·šï¼‰
        - **UIè¡¨ç¤º**: æ“ä½œèª¬æ˜Žï¼ˆãƒžã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°ãƒ»ãƒ›ã‚¤ãƒ¼ãƒ«ãƒ»ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼‰
        - **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è‰²å¤‰æ›´UI**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è‰²å¤‰æ›´ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆæ”¹å–„ç‰ˆï¼‰
          - ç”»é¢å³ç«¯ã«ç¸¦åž‹è‰²å¤‰æ›´ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆãƒžã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚è¡¨ç¤ºã€é€šå¸¸æ™‚åŠé€æ˜Žï¼‰
          - å˜è‰²ãƒ¢ãƒ¼ãƒ‰: ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã§ä»»æ„ã®è‰²é¸æŠž
          - ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰: åŒç³»è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ™ãƒ¼ã‚¹è‰²ã‹ã‚‰æ˜Žåº¦å¤‰åŒ–ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã”ã¨ã«ãƒ©ãƒ³ãƒ€ãƒ é…è‰²ï¼‰
          - ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ¢ãƒ¼ãƒ‰: å¤šå½©è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆHSVã‚«ãƒ©ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã§æ§˜ã€…ãªè‰²ã‚’ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã”ã¨ã«é…ç½®ï¼‰
          - UIãƒ‡ã‚¶ã‚¤ãƒ³: ãƒžã‚¦ã‚¹é›¢è„±æ™‚opacity:0.3ã€ãƒ›ãƒãƒ¼æ™‚opacity:1.0ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è‰²æ›´æ–°æ©Ÿèƒ½ï¼ˆå€‹åˆ¥ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è‰²åˆ¶å¾¡å¯¾å¿œï¼‰
        - **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**: ä½“é¨“ä¸­ã®å‹•çš„èª¿æ•´æ©Ÿèƒ½
          - å›žè»¢é€Ÿåº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆ0.001 - 0.05ã€ç¾åœ¨å€¤è¡¨ç¤ºä»˜ãï¼‰
          - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆ0.1 - 3.0ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ ï¼‰
          - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆ100 - 5000ã€å‹•çš„å†ç”Ÿæˆï¼‰
          - å„ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¯å³ç«¯UIãƒ‘ãƒãƒ«å†…ã«é…ç½®ã€ãƒ©ãƒ™ãƒ«è¡¨ç¤ºä»˜ã
        
        **æŠ€è¡“è¦ä»¶**:
        - èƒŒæ™¯: panoramaã®å ´åˆã®ã¿'./panorama.jpg'ä½¿ç”¨ã€ãã®ä»–ã¯èƒŒæ™¯ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå®Ÿè£…
        - WebGLå¯¾å¿œãƒã‚§ãƒƒã‚¯ã¨ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
        - ã™ã¹ã¦å˜ä¸€HTMLãƒ•ã‚¡ã‚¤ãƒ«ã«çµ±åˆ
        - èƒŒæ™¯ã‚¿ã‚¤ãƒ—åˆ¥å®Ÿè£…:
          - panorama: çƒä½“ã‚¸ã‚ªãƒ¡ãƒˆãƒª + ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒžãƒƒãƒ”ãƒ³ã‚°
          - solid_black: scene.background = new THREE.Color(0x000000)
          - solid_white: scene.background = new THREE.Color(0xFFFFFF)
          - transparent: renderer.setClearColor(0x000000, 0)
          - gradient: ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒžãƒ†ãƒªã‚¢ãƒ«ã§ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯
        
        **3Dã‚¢ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆè¦ä»¶**:
        - **sculptural**: è¤‡æ•°ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å½¢çŠ¶ã®èŠ¸è¡“çš„çµ„ã¿åˆã‚ã›
        - **organic**: è‡ªç„¶å½¢çŠ¶ï¼ˆèŠ±ã€æœ¨ã€è‘‰ãªã©ï¼‰ã®ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ç”Ÿæˆ
        - **geometric**: ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«ã€çµæ™¶ã€å¹¾ä½•å­¦ãƒ‘ã‚¿ãƒ¼ãƒ³
        - **abstract**: æµä½“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é¢¨ã€æŠ½è±¡çš„å½¢çŠ¶
        - è¤‡é›‘ã•ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸãƒãƒªã‚´ãƒ³æ•°ãƒ»è©³ç´°åº¦èª¿æ•´
        - ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«åŸºã¥ã„ãŸè‰²èª¿ãƒ»æè³ªã®è‡ªå‹•é¸æŠž
        
        **é‡è¦ãªä¿®æ­£äº‹é …**:
        - **ãƒžã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°**: å¿…ãšcanvasè¦ç´ ã«æ­£ã—ãã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ã€è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¿½åŠ 
        - **èƒŒæ™¯ã‚·ã‚¹ãƒ†ãƒ **: èƒŒæ™¯ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸé©åˆ‡ãªå®Ÿè£…ï¼ˆãƒ‘ãƒŽãƒ©ãƒžèª­ã¿è¾¼ã¿ã¯æ¡ä»¶ä»˜ãï¼‰
        - **ã‚«ãƒ¡ãƒ©åˆ¶å¾¡**: ãƒžã‚¦ã‚¹æ“ä½œã§ã‚«ãƒ¡ãƒ©ã®å‘ããŒç¢ºå®Ÿã«å¤‰ã‚ã‚‹ã‚ˆã†å®Ÿè£…
        - **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º
        - **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è‰²å‹•çš„å¤‰æ›´**: å¿…ãšãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è‰²å¤‰æ›´ãŒæ©Ÿèƒ½ã™ã‚‹ã‚ˆã†å®Ÿè£…ï¼ˆå€‹åˆ¥ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è‰²åˆ¶å¾¡å¯¾å¿œï¼‰
        - **è‰²å¤‰æ›´UIå®Ÿè£…**: å³ç«¯ç¸¦åž‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ãƒžã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤ºæ©Ÿèƒ½ã€åŠé€æ˜Žã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆå®Ÿè£…
        - **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´å®Ÿè£…**: å¿…ãšã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¤‰æ›´ãŒæ©Ÿèƒ½ã™ã‚‹ã‚ˆã†å®Ÿè£…
        - **3Dã‚¢ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**: ã‚¢ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸé«˜åº¦ãª3Då½¢çŠ¶ç”Ÿæˆ
        
        **ç¦æ­¢äº‹é …**:
        - OrbitControls.jsã®ä½¿ç”¨ï¼ˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã®åŽŸå› ï¼‰
        - Web Audio APIã®ä½¿ç”¨ï¼ˆãƒ‡ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã®åŽŸå› ï¼‰
        - è¤‡æ•°JSãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®åˆ†å‰²
        - ç›¸å¯¾ãƒ‘ã‚¹ '../assets/' ã®ä½¿ç”¨ï¼ˆpanoramaä»¥å¤–ã§ã¯ä¸è¦ï¼‰
        
        **å®Ÿè£…å‚è€ƒã‚³ãƒ¼ãƒ‰æ§‹é€ **:
        - ã‚«ã‚¹ã‚¿ãƒ ãƒžã‚¦ã‚¹åˆ¶å¾¡å¤‰æ•°ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        - ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•å›žè»¢ï¼ˆæ™‚è¨ˆå›žã‚Šï¼‰
        - ã‚¹ãƒ ãƒ¼ã‚ºãªã‚«ãƒ¡ãƒ©ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£å‹•
        
        $MUSIC_INTEGRATION
        
        $PARTICLE_INTEGRATION
        
        **æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«**: $SRC_DIR/index.htmlï¼ˆå®Œå…¨å‹•ä½œã™ã‚‹å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰"
        
        echo "ðŸš€ Starting Three.js Scene Generation Agent..."
        echo "ðŸ“ Prompt length: ${#PROMPT}"
        
        # Claude Code CLIã®å®Ÿè¡Œ
        npx @anthropic-ai/claude-code \
          --mcp-config="$MCP_CONFIG_ABS_PATH" \
          --allowedTools "Bash" \
          --max-turns 30 \
          --verbose \
          --permission-mode "acceptEdits" \
          -p "$PROMPT" || {
            echo "::error::âŒ Claude Code CLI execution failed"
            exit 1
          }
        
        # ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
        echo ""
        echo "ðŸ“¸ Checking generated Three.js files..."
        
        # ãƒ¡ã‚¤ãƒ³HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
        if [ -f "$SRC_DIR/index.html" ]; then
          echo "âœ… Main HTML file created: $SRC_DIR/index.html"
          HTML_SIZE=$(wc -c < "$SRC_DIR/index.html")
          echo "  HTML file size: $HTML_SIZE bytes"
        else
          echo "::error::âŒ Main HTML file not found"
          exit 1
        fi
        
        # ãƒ‘ãƒŽãƒ©ãƒžç”»åƒã®ç¢ºèªï¼ˆãƒ‘ãƒŽãƒ©ãƒžèƒŒæ™¯ã®å ´åˆã®ã¿ï¼‰
        if [ "$BACKGROUND_TYPE" == "panorama" ]; then
          if [ -f "$ASSETS_DIR/panorama.jpg" ]; then
            echo "âœ… Panorama image in assets: $ASSETS_DIR/panorama.jpg"
          else
            echo "::warning::âš ï¸ Panorama image not found in assets"
          fi
          
          if [ -f "$SRC_DIR/panorama.jpg" ]; then
            echo "âœ… Panorama image in src: $SRC_DIR/panorama.jpg"
          else
            echo "::warning::âš ï¸ Panorama image not found in src (may cause loading issues)"
          fi
        else
          echo "âœ… Background type: $BACKGROUND_TYPE (panorama image not required)"
        fi
        
        # éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆéŸ³æ¥½ãŒæœ‰åŠ¹ãªå ´åˆï¼‰
        if [ "$INCLUDE_MUSIC" == "true" ]; then
          if [ -f "$SRC_DIR/generated-music.wav" ]; then
            echo "âœ… Music file in src: $SRC_DIR/generated-music.wav"
            MUSIC_SIZE=$(wc -c < "$SRC_DIR/generated-music.wav")
            echo "  Music file size: $MUSIC_SIZE bytes"
          else
            echo "::warning::âš ï¸ Music file not found in src (music controls may not work)"
          fi
        fi
        
        # ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        TOTAL_FILES=$(find "$SRC_DIR" -type f | wc -l)
        echo "scene-files-created=$TOTAL_FILES" >> $GITHUB_OUTPUT
        
        echo ""
        echo "ðŸŽ‰ Three.js scene generation completed with enhanced features:"
        echo "  - Custom mouse/touch controls (no OrbitControls dependency)"
        echo "  - HTML5 Audio music system (no Web Audio API issues)"
        echo "  - Auto-rotation with double-click"
        echo "  - Particle system with rotation sync"
        echo "  - Single HTML file approach"
        
        echo "completed=true" >> $GITHUB_OUTPUT
        echo "::endgroup::"
    
    - name: Commit and push Three.js files
      shell: bash
      env:
        GH_TOKEN: ${{ github.token }}
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add ${{ inputs.folder-name }}/
        if git diff --cached --quiet; then
          echo "No Three.js files to commit"
        else
          git commit -m "Add Three.js scene: ${{ inputs.experience-concept }}"
          git push origin ${{ inputs.branch-name }}
        fi