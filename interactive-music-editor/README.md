# 🎵 Interactive Music Editor

**次世代音楽創作プラットフォーム - モジュラー・クリエイティブ・ツールキット**

自然言語指示からリアルタイムライブコーディングまで、革新的な音楽制作体験を提供する実験的プロジェクトです。

## 🚀 開発進捗概要

### ✅ **実装完了済み機能**
- **Web Audio APIベースの音楽エンジン**: リアルタイム音声合成・複数楽器対応
- **ヒートマップビジュアライゼーション**: 楽器×時間軸の音量・音高可視化
- **日本語自然言語処理**: "ピアノで明るい曲を" → DSLコード自動生成
- **タイムラインマーカー同期**: 音楽再生とビジュアル要素の完全同期
- **コードエディター連動**: Generate/Play機能差別化とリアルタイム実行
- **WebSocketリアルタイム通信**: ブラウザ⇔サーバー双方向通信
- **MCPサーバー実装**: FastMCPベース音楽制作ツール（10種類）

### 🔧 **現在の技術課題**
- **MCPサーバー認識問題**: Claude CodeがMCPツールを認識しない
- **設定ファイル問題**: 正しいMCP設定方法の特定が必要
- **統合テスト未完了**: CLI→MCP→WebSocket→ブラウザの全体フロー

### 🎯 **現在の動作状況**
- ✅ **WebSocketサーバー**: 動作中（minimal_websocket.py）
- ✅ **ブラウザビジュアル**: 表示・WebSocket接続成功
- ✅ **MCPサーバー**: 手動起動確認済み（server_fixed.py）
- ❌ **Claude Code統合**: MCPツール認識せず

### 🔍 **判明した設計課題**
- **音符ベースアーキテクチャの限界**: 15秒以上の楽曲では非実用的
- **タイムライン指向設計の必要性**: パターンベース・リアルタイム制御への移行
- **動画統合を見据えたアーキテクチャ**: 将来の音楽ビデオ生成機能

## 🌟 プロジェクトビジョン

### 🎯 核心コンセプト
- **自然言語 → コード変換**: "ロマンチックな雰囲気に" → `track('violin').emotion('romantic')`
- **リアルタイムヒートマップ**: 楽器×時間軸のビジュアライゼーション  
- **双方向連携**: 音楽 ⇔ 3D ⇔ アート ⇔ 動画
- **モジュラー設計**: 機能単位での拡張・統合

### 🎨 革新的機能

#### 🔥 **ヒートマップビジュアル**
```
🎻 Violin │━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│ 連続音（線）
🎹 Piano  │████░░░░████░░░░████░░░░████│ 断続音（ブロック）
🥁 Drums  │▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌ ▌│ パルス音（短バー）
          └─────────────────────────┘
           色の濃さ = 音量 | 色相 = 音高
```

#### 🤖 **自然言語音楽制作**
```javascript
// 自然言語入力例
"2分のところでピアノをもっと小さく" 
    ↓ AI変換
track('piano').at(120).volume(0.3)
    ↓ 実行・可視化
ヒートマップ更新 + リアルタイム演奏
```

#### 🎼 **ライブコーディング統合**
```javascript
// JavaScriptベース音楽DSL
pick("c#7 a#9 d#7").struct("x-x-").mux(supersaw)
  .gain(0.5).hpf(100).room(0.3)
  ._heatmap({ track: 'lead', width: 800 })
```

## 🏗️ プロジェクト構造

```
📂 interactive-music-editor/
├── 📄 README.md               # このファイル
├── 📄 package.json            # 依存関係管理
├── 🗂️ mcp-server/             # Web Audio API MCPサーバー
│   ├── server.py             # FastMCP音楽サーバー
│   ├── requirements.txt      # Python依存関係
│   └── tools/                # 音楽生成・解析ツール
├── 🗂️ web-interface/          # Webアプリケーション
│   ├── index.html            # メインインターface
│   ├── editor/               # Monaco Editor統合
│   ├── visualizer/           # ヒートマップ・ビジュアル
│   └── audio-engine/         # Web Audio API
├── 🗂️ prototypes/             # 実験・プロトタイプ
│   ├── heatmap-test/         # ヒートマップ実験
│   ├── dsl-parser/           # DSL構文解析実験
│   └── bridge-experiments/   # 音楽⇔ビジュアル連携実験
└── 🗂️ docs/                   # ドキュメント
    ├── architecture.md       # システム設計
    ├── dsl-specification.md  # DSL言語仕様
    └── api-reference.md      # API リファレンス
```

## 💡 参考にした先行技術

参考アプリの優れた設計パターンから学んだ点：
- **パターンベース音楽制御**: `pick("c#7 a#9 d#7").struct("x-x-")`
- **リアルタイム音響効果**: `.gain(0.5).hpf(100).room(0.3)`
- **時間軸ベース設計**: 音符の羅列ではなく時間の流れに沿った制御

## 🔧 **緊急対応事項（現在）**

### **MCPサーバー統合の課題**
1. **Claude Code設定問題**
   - 現状: `claude -c config.json` での設定ファイル指定方法を確認中
   - 課題: FastMCPサーバーがClaude Codeに認識されない
   - 対応: 正しいMCP設定形式の特定と実装修正

2. **現在のファイル構成**
   ```
   mcp-server/
   ├── server.py              # 旧実装（クラスベース）
   ├── server_fixed.py        # 新実装（FastMCP標準形式）
   ├── minimal_websocket.py   # WebSocket通信サーバー
   └── requirements.txt       # 依存関係
   ```

3. **動作確認済み要素**
   - WebSocket通信: ブラウザ⇔minimal_websocket.py ✅
   - MCPサーバー: server_fixed.py単体起動 ✅  
   - ブラウザUI: ヒートマップ表示・音楽再生 ✅

4. **未解決要素**
   - Claude Code → MCPサーバー通信 ❌
   - MCP → WebSocket → ブラウザ連携 ❌

## 🚀 開発フェーズ

### 📍 **Phase 1: ローカル開発** (現在 - 統合作業中)
- ✅ プロジェクト構造設計
- ✅ MCPサーバー構築
- ✅ 基本ヒートマップ実装
- ✅ 音楽DSL設計
- ✅ Web Audio APIエンジン完成
- ✅ 日本語自然言語処理
- ✅ タイムライン同期システム
- 🔄 **Claude Code-MCP統合**（作業中）

### 🔄 **Phase 1.5: アーキテクチャ改善** (統合完了後)
- 🔄 音符ベース → タイムラインベース設計へ移行
- 🔄 パターン駆動音楽制御の実装
- 🔄 Monaco Editorライブコーディング統合
- 🔄 より高度な音楽DSL（参考アプリパターン）

### 📦 **Phase 2: モジュール化**
- kamuicode-workflow/kamui-modulesに移植
- GitHub Actions統合
- 独立モジュールパッケージ化

### 🌟 **Phase 3: エコシステム統合**
- 既存Three.js・画像生成モジュールとの連携
- 統合ワークフロー作成
- 自動音楽ビデオ生成

### 🔮 **Phase 4: 配布・コミュニティ**
- NPMパッケージ化 `@kamuicode/web-audio-mcp`
- オープンソース化
- SNS配信・コミュニティ形成

## 🛠️ 技術スタック

### **コア技術**
- **Web Audio API**: リアルタイム音響処理
- **FastMCP**: Claude Code統合
- **Monaco Editor**: ライブコーディング環境
- **Canvas/WebGL**: ビジュアライゼーション

### **統合技術**
- **Three.js**: 3D音楽体験
- **GitHub Actions**: 自動化パイプライン
- **MCPエコシステム**: 他ツールとの連携

## 🎭 使用例・ワークフロー

### 🎵 **現在実装済みの機能**
```javascript
// 自然言語入力（日本語対応）
"ピアノで明るい曲を作って" 
    ↓ 自動変換
track('piano')
  .play(['C4', 'E4', 'G4', 'C5'])
  .timing([0, 0.5, 1.0, 1.5])

// Generate（コード生成）
1. 自然言語 → DSLコード変換
2. ヒートマップデータ生成  
3. ビジュアル更新

// Play（音楽再生）
1. Web Audio API音声合成
2. タイムラインマーカー同期
3. リアルタイム視覚フィードバック
```

### 🎛️ **実装済み楽器・機能**
- **楽器**: Piano, Violin, Drums, Bass
- **音響効果**: ADSR包絡線, 楽器別音色
- **自然言語**: 日本語処理（ピアノ、ドラム、ロマンチック、ドラマチック等）
- **ビジュアル**: リアルタイムヒートマップ、音楽同期マーカー

### 🔮 **将来の統合構想**
```bash
# 音楽から3D生成（将来）
music.beat → scene.lights.flash
music.frequency → mesh.morphTargets

# 3Dから音楽制御（将来）
mouse.position → filter.cutoff
object.rotation → reverb.size
```

## 🎯 開発指針・課題・今後の方針

### **現在の技術的課題**
- **音符ベース設計の限界**: 現在のアーキテクチャは短い楽曲（〜15秒）に適している
- **スケーラビリティ問題**: 長い楽曲や複雑な楽曲では音符配列が非実用的に
- **リアルタイム制御の必要性**: パターンベース・時間軸ベースの制御が必要

### **次期開発方針**
1. **タイムライン指向アーキテクチャ**: 参考アプリのパターンを取り入れる
2. **パターン駆動制御**: `pick().struct().effect()` 形式の採用
3. **動画統合準備**: 音楽ビデオ生成を見据えた設計
4. **Monaco Editor統合**: 本格的ライブコーディング環境

### **開発プロセス**
- **MCPエージェント**: 実験・プロトタイプ・试行錯誤
- **GitHub Actions**: 動作確認・記録・自動化

### **モジュラー開発**
- 機能は独立モジュールとして開発
- 段階的統合・組み合わせ自由
- 将来の拡張・配布を考慮

### **ユーザー体験重視**
- 直感的な自然言語インターfェース
- リアルタイム・インタラクティブ
- 初心者からプロまで対応

## 📊 開発経緯・学んだこと

### **実装過程で解決した課題**
1. **タイムラインマーカー同期**: CSSアニメーション競合 → JavaScript制御に切り替え
2. **Audio Engine統合**: 外部ファイル読み込みエラー → インライン実装で解決
3. **自然言語処理**: 英語のみ → 日本語対応実装
4. **Generate vs Play**: 機能混同 → 明確な差別化実装

### **技術的発見**
- **Web Audio API**: 学習曲線あるが強力、リアルタイム性能良好
- **ヒートマップ可視化**: 音楽理解に大きく貢献、直感的
- **自然言語処理**: ルールベースでも実用的、パターンマッチング有効

## 📱 SNS配信戦略

- **実験過程**: 録画 → X(Twitter)配信
- **作品紹介**: ショート動画での魅力訴求
- **技術解説**: 開発過程の透明性

## 🤝 コントリビューション

このプロジェクトは実験的・探索的な性質を持ちます。
新しいアイデア・機能追加・改良提案を歓迎します。

## 📄 ライセンス

MIT License - 自由に使用・改変・配布可能

---

**🎶 "Where code meets creativity, music comes alive!" 🎶**

*KamuiCode Creative Platform - Interactive Music Editor*